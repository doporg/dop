# DOP

随着微服务的普及以及企业对需求交付的频率和质量要求的提高, 运维的复杂性和成本大大提高, DevOps是降低运维成本提高交付能力的重要方法. 然而, 虽然市场上有很多用于支持DevOps的开源工具, 但这些工具彼此之间相对独立, 数据不通, 使用起来繁琐、门槛高. 各大厂商也都在研发自己的DevOps平台, 如阿里云的云效, 华为云的DevCloud, 但这些产品均为商业产品, 我们无法获取DevOps整个流程中产生的数据, 更无法做定制化的开发, 因此决定开发一个开源项目--DOP. DOP对标云效和DevCloud两款产品, 提供方便易用的DevOps流程所涉及的功能, 从而可以采集数据、进行定制化开发, 辅助各项DevOps领域的研究的同时, 各项研究成功也能反馈到DOP中.

DOP是一个DevOps平台，你可以在DOP平台完成DevOps流程中的编码、构建、部署、测试等多个环节, 从而实现项目的CI/CD.


DOP整体上来看是一个多层的系统，其架构如图所示：

![](https://clsaa-markdown-imgbed-1252032169.cos.ap-shanghai.myqcloud.com/very-java/2019-05-23-165203.png)

**基础设施层**：平台管理的应用、及平台本身的服务都将部署在kubernetes中，一些工具会直接部署在虚拟机或物理机上。

**持久层**：使用MySQL和MongoDB，使用ceph进行分布式文件存储，对kubernetes中有状态应用的数据进行存储。

**中间件层**：使用阿里的RocketMQ作为消息队列，Redis作为缓存数据库。

**工具层**：接下来在右边是工具层。工具层主要包括一些开源的工具，这些工具提供一些基础的能力。业务层通过业务逻辑对这些能力进行组合整理最终提供给用户。比如jenkins提供流水线操作的能力（流水线的并行、等待）

**基础服务层**：左边是基础服务层，从这层开始是我们自己实现的一些服务。基础层服务为微服务架构和基本业务逻辑提供支持, 包括服务发现、审计、登录、权限管理、用户管理、消息服务，他们为业务层服务提供一些通用的功能。

**业务层**：业务层服务为用户使用的基本功能提供支持, 包括测试、代码管理、应用管理、流水线管理、容器镜像管理等服务，分别对应我们前面提到的用户使用的各种各样的功能。

**接入层**：接入层是一个API网关，主要处理客户端OAuth2.0认证和用户状态认证 两个认证流程。

**接口层**：包括用户使用的WebUI 统一登录 RESTful API。外部系统在通过客户端OAuth2.0认证后可以调用平台API。

**DOP系统使用了微服务架构，我们构建了基础层服务为微服务架构和基本业务逻辑提供支持，并且按照业务上下文将业务划分为测试、代码、应用管理、流水线等微服务，服务之间多通过HTTP协议通信，少数通过消息队列通信**。

业务模块与DevOps流程的关系，如下图所示：

![](https://clsaa-markdown-imgbed-1252032169.cos.ap-shanghai.myqcloud.com/very-java/2019-05-24-013749.png)

单个业务服务的架构，如下图所示：

![](https://clsaa-markdown-imgbed-1252032169.cos.ap-shanghai.myqcloud.com/very-java/2019-05-24-014534.jpg)

每个服务都使用贫血模型，被设计为分层结构。controller对API网关转发来的请求进行处理，service层相对比较复杂，它可能会使用持久层对数据库进行操作或使用通用处理层调用API。