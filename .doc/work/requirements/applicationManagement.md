# DOP(应用管理模块)需求文档
## 变更记录
|版本|修改人|时间|编辑内容|
|:--|:---:|:--:|:---:|
|V1.0|郑博文|2019/2/23|草稿|
|V1.1|郑博文|2019/2/24|草稿|
|V2.0|郑博文|2019/2/25|初稿|
|V2.0|郑博文|2019/2/26|修正稿|

## 一、背景介绍
DOP需要引入应用管理模块来对应用进行管理。其中包含应用的**项目管理、应用基础信息管理、环境管理、流水线关联、版本管理、部署、重启、下线、变量管理、用户管理**等功能。

## 二、应用管理模块功能点介绍

### 2.1 项目管理
点击菜单栏**项目**按钮以进入项目页面。
下方以列表形式列出所有项目,按创建时间倒序排列。
右上角有**查看已结项目**过滤器，以切换是否显示已结项目。

#### 2.1.1 项目创建
点击**创建项目**按钮以创建页面

创建项目时应配置以下信息：
* 项目类型（研发项目或业务项目）
* 项目名称
* 公开性

可包含：
* 项目背景描述
* 上级背景
* 所属项目集

#### 2.1.2 创建项目集
点击**创建项目集**按钮以创建项目集。

创建项目集时应配置以下信息：
* 项目集名称
* 公开性

可以包含：
* 项目背景
* 关联项目（集）

#### 2.1.2 进入项目
点击**项目名**即可进入项目

### 2.2 基本信息管理
#### 2.2.1 创建、删除、查询基本信息
进入项目后，点击菜单栏“应用”按钮进入应用管理模块,此时可以点击“创建应用”按钮新建应用。下方以列表形式列出所有应用，列表按创建时间倒序排列。
右上角有搜索框用于检索，可使用应用名称或应用ID进行检索，每页显示10条应用信息，超出则分页。

**应用列表的每一行应列出：**
* 应用的ID
* 应用的名称
* 应用的owner
* “进入流水线” 链接
* “应用删除”   链接

点击“**应用的名称**”可进入详情页面，点击“**进入流水线**”可进入流水线，点击“**应用删除**”后，弹出**确认删除**对话框，确认后可删除应用。

**创建应用时用户需按序配置以下内容：**
1. 应用的名称
2. 所属项目
3. 开发模式
4. 代码源
5. 关联/新建 代码仓库
6. 选择应用模板
7. 构建配置

#### 2.2.2 修改基本信息
点击“应用名称”进入应用管理页面后，默认显示概述页面（即基本信息）。

应包含：
* 应用名称
* 注册时间	
* 描述	
* 研发 修改
* 代码仓库地址	
* 生产环境DB地址	
* 测试环境DB地址	
* 测试环境域名	
* 生产环境域名	
* 自定义测试域名

右上角点击**修改**按钮即可修改信息。

### 2.3 环境信息管理
#### 2.3.1 创建环境信息
点击菜单栏**环境**按钮即可进入环境管理页面。
进入页面后有环境列表列出所有环境。
此时可以点击**创建环境**按钮创建新的环境。

**创建环境时，需要配置以下信息：**
* 环境级别
* 部署方式（目前仅kubernetes）
* 环境名称

#### 2.3.2 修改与删除环境信息
在每一个环境信息中也可以使用**删除环境**按钮删除，或使用**修改环境**按钮修改环境信息。

#### 2.3.3 部署配置用
使用**部署配置**按钮进行配置部署

**使用部署配置进行配置时，需要配置以下信息：**
* 部署方式（目前仅kubernetes）
* 目标集群
* 命名空间
* 服务
* 发布策略（*蓝绿发布，灰度发布，滚动升级，分批发布*）

### 2.4发布管理
#### 2.3.1 关联流水线
选择流水线，进行关联，关联之后

#### 2.4.2 版本管理
点击**版本**按钮进入版本页面
下方以列表形式列出所有所有，列表按创建时间倒序排列。
**右上角检索框**可用于检索，可使用**版本号、版本标签**进行检索，在**高级过滤**下可使用**创建时间、创建人、部署环境**进行过滤。每页显示20条版本信息，超出则分页。

##### 2.4.2.1 增加基本信息、构建信息、环境信息、代码信息、变更信息
版本的基本信息、构建信息、环境信息、代码信息、变更信息在提交版本时**自动创建**
在**流水线完成发布时**，调用数据接口，创建新的版本信息

##### 2.4.2.2 查看基本信息、构建信息、环境信息、代码信息、变更信息
点击**版本信息**可以查看详细的以上所有信息


#### 2.4.3 主干部署、重启、下线
使用**主干部署**按钮将应用部署至环境中，使用**重启应用**按钮以重启，使用**下线按钮**将应用下线。

### 2.5 变量管理
在菜单栏点击**变量**按钮以进入变量管理页面。
在前端所有变量的**值**都以“*”显示。
且数据库中对相应的字段进行加密以保证私密性。
#### 2.5.1 创建变量
点击**创建变量**按钮以创建变量

**创建变量时，需要以下参数**
* 键
* 值

该变量列表在构建时会生成一个带明文的配置文件以供使用，在调用时使用键名匹配。

#### 2.5.2 修改、删除、查询变量
在变量管理页面，变量会以列表的形式列出。
在变量列表的每一行，点击**修改**按钮给该变量的**重新赋值**。
在每一行末，点击**删除变量**以删除该变量。

### 2.6 用户管理
#### 2.6.1 登入、登出
接入SSO来管理用户的登入与登出

#### 2.6.2 权限管理
接入权限服务来管理用户的登入与登出

#### 2.6.3 操作审计
接入权限服务来管理用户的登入与登出

## 三、功能点分析
### 项目管理 ###
|用户故事|功能点|M|S|C|W|约束|估时|
|:-----|:----:|:-:|:-:|:-:|:-:|:-:|:-:|
|作为用户，我希望创建查看项目|创建项目|Y| | | | |2|
| |查询项目|Y| | | | |1|
|作为用户，我希望创建项目集|创建项目集| | |Y| | |1|

### 应用基本信息管理 ###
|用户故事|功能点|M|S|C|W|约束|估时|
|:-----|:----:|:-:|:-:|:-:|:-:|:-:|:-:|
|作为用户，我希望创建修改应用基本信息|创建应用基本信息|Y| | | | |2|
| |删除应用基本信息|Y| | | | |1|
| |修改应用基本信息| |Y| | | |1|
| |查询应用基本信息|Y| | | | |2|


### 环境管理 ###
|用户故事|功能点|M|S|C|W|约束|估时|
|:-----|:----:|:-:|:-:|:-:|:-:|:-:|:-:|
|作为用户，我希望创建修改环境信息|创建环境信息|Y| | | | |2|
| |删除环境信息|Y| | | | |0.5|
| |修改环境信息| |Y| | | |0.5|
| |查询环境信息|Y| | | | |1|
|作为用户，我希望修改部署方式|部署方式修改|Y| | | | |3|
|作为用户，我希望改变目标集群|目标集群增加|Y| | | | |2|
| |目标集群查询|Y| | | | |1|
|作为用户，我希望改变发布策略|发布策略修改|Y| | | | |2|

### 发布管理 ###
|用户故事|功能点|M|S|C|W|约束|估时|
|:-----|:----:|:-:|:-:|:-:|:-:|:-:|:-:|
|作为用户，我希望将应用与流水线关联起来|关联流水线|Y| | | | |2|
|作为用户，我希望管理应用各版本的基本信息|创建基本信息| |Y| | | |2|
| |查询基本信息| |Y| | | |1|
|作为用户，我希望管理应用各版本的构建信息|创建构建信息| |Y| | | |2|
| |查询构建信息| |Y| | | |1|
|作为用户，我希望管理应用各版本的构建信息|创建环境信息| |Y| | | |2|
| |查询环境信息| |Y| | | |1|
|作为用户，我希望管理应用各版本的变更信息|创建变更信息| |Y| | | |2|
| |查询变更信息| |Y| | | |1|
|作为用户，我希望将我的应用部署至主干|部署主干|Y| | | | |3|
|作为用户，我希望重启我的应用|重启| |Y| | | |1|
|作为用户，我希望将我的应用下线|下线|Y| | | | |1|


### 变量管理 ###
|用户故事|功能点|M|S|C|W|约束|估时|
|:-----|:----:|:-:|:-:|:-:|:-:|:-:|:-:|
|作为用户，我希望创建修改变量|创建变量|Y| | | | |2|
| |删除变量|Y| | | | |1|
| |查询变量|Y| | | | |1|

### 用户管理
|用户故事|功能点|M|S|C|W|约束|估时|
|:-----|:----:|:-:|:-:|:-:|:-:|:-:|:-:|
|作为用户，我希望登录与注销|登入|Y| | | |接入SSO|2|
| |注销|Y| | | |接入SSO|1|
|作为用户，我希望不同角色拥有不同的权限|权限控制|Y| | | |接入权限服务|2|
|作为用户，我希望操作审计|操作审计|Y| | | |接入审计服务|2|
